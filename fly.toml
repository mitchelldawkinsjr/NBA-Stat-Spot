# fly.toml app configuration file
# See https://fly.io/docs/reference/configuration/ for information about how to use this file.

app = "nba-stat-spot-ai"
primary_region = "iad"

[build]
  dockerfile = "Dockerfile"

[env]
  ENV = "production"
  PORT = "8000"
  CORS_ORIGINS = "https://mitchelldawkinsjr.github.io,https://mitchelldawkinsjr.github.io/NBA-Stat-Spot,http://localhost:5173"
  DATABASE_URL = "sqlite:///./nba_props.db"

[processes]
  app = "python -m uvicorn app.main:app --host 0.0.0.0 --port ${PORT:-8000}"
  cron = "supercronic /app/crontab"

[http_service]
  internal_port = 8000
  force_https = true
  auto_stop_machines = "off"  # Keep running to avoid cold starts - use "off" string to disable auto-stop
  auto_start_machines = true
  min_machines_running = 1    # Always keep 1 machine ready
  processes = ["app"]
  
  # Health check for better reliability
  [http_service.checks]
    [http_service.checks.health]
      grace_period = "10s"
      interval = "30s"
      method = "GET"
      timeout = "5s"
      path = "/healthz"

[[vm]]
  cpu_kind = "shared"    # Shared CPUs are much cheaper than dedicated
  cpus = 2                # 2x CPUs for parallel processing (stat-leaders endpoint)
  memory_mb = 512         # 2x memory for better caching (doubled from 256MB)
